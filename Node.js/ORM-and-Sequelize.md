# ORMê³¼ Sequelize í”„ë ˆì„ì›Œí¬

## ORMì´ë€? 

- Object Relational Mappingì˜ ì•½ì
- ORMì€ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë¨ ì–¸ì–´ë¥¼ ì´ìš©í•´ DB í”„ë¡œê·¸ë˜ë°ì„ í•  ë•Œ RDBMSì˜ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë° ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ SQLì„ ì˜ ëª¨ë¥´ë”ë¼ë„ í”„ë¡œê·¸ë˜ë°ì ì¸ ë°©ë²•ì„ ì´ìš©í•˜ê¸° ì‰½ê²Œ ë°ì´í„° ëª¨ë¸ ê°ì²´ ê¸°ë°˜ìœ¼ë¡œ DB í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì œê³µí•œë‹¤.

### ëª¨ë¸

- ë°±ì—”ë“œ ê°œë°œ ì–¸ì–´ë¡œ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ í‘œí˜„í•œë‹¤.
- ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ í‘œí˜„í•œ ëª¨ë¸ì˜ ê°ì²´(ì¸ìŠ¤í„´ë“œí™”=ë©”ëª¨ë¦¬ì— ë°ì´í„° êµ¬ì¡°ë¥¼ ì˜¬ë¦¬ëŠ” ë°©ë²•) ëª¨ë¸ì— ë°ì´í„°ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.
- ë°ì´í„°ê°€ ë‹´ê¸´ ëª¨ë¸ ê°ì²´ë¥¼ ë ˆì´ì–´ ê°„ ë°ì´í„°ë¥¼ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

### ëª¨ë¸ì˜ ì¢…ë¥˜

1. Data ëª¨ë¸ : ë°ì´í„° ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ mappingë˜ëŠ” ë°±ì—”ë“œ ì¸¡ ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ë§í•œë‹¤.
    - í…Œì´ë¸” êµ¬ì¡°ì™€ ë™ì¼í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ë°±ì—”ë“œ ê°œë°œ ì–¸ì–´ë¡œ í´ë˜ìŠ¤(ê°ì²´)ë¡œ ì •ì˜í•œë‹¤.
    - ë°ì´í„° ëª¨ë¸ì—ëŠ” ë°ì´í„°ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.
2. Entity ëª¨ë¸ : ë¹„ì§€ë‹ˆìŠ¤ ê´€ì ì—ì„œ ì •ë³´ì˜ êµ¬ì¡°ë¥¼ í‘œí˜„í•œ ëª¨ë¸ì„ ë§í•œë‹¤.
    - ex) age ì†ì„± ì¶”ê°€, í…Œì´ë¸”ì—ëŠ” ì—†ëŠ” ì†ì„±ì„
3. DTO(Data Transfer Object) ëª¨ë¸ : ë°ì´í„°ì˜ ì¼ê´„ ì €ì¥ ë° ì´ë™ì„ ìœ„í•´ ì¶”ê°€ë¡œ ë§Œë“œëŠ” ëª¨ë¸ì„ ë§í•œë‹¤.
    - ëª©ì ì€ ë§ì€ ë°ì´í„°ë¥¼ í•œë²ˆì— ë¹ ë¥´ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ ì „ì†¡ ì „ìš© ëª¨ë¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´ Dataëª¨ë¸ì— `userModel`ê³¼ `productModel`ì´ ìˆë‹¤ê³  ì³¤ì„ ë•Œ, DTO ëª¨ë¸ë¡œëŠ” `userProductModel`ì„ ë§Œë“¤ì–´ ê·¸ ì•ˆì— `userModel`ê³¼ `productModel`ì˜ ì†ì„±ì„ ëª¨ë‘ ë„£ì–´ë†“ê³  í•œë²ˆì— ì „ì†¡ì„ í•œë‹¤.
4. View ëª¨ë¸ : í™”ë©´ì „ìš© ëª¨ë¸ì„ ë§í•œë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, `userViewModel`ì„ ë§Œë“¤ì–´, ê·¸ ì†ì—ëŠ” `userModel`ì´ë¼ëŠ” ë°ì´í„° ëª¨ë¸ê³¼ age ë“± ì¶”ê°€ì ì¸ ì†ì„±ì„ ë” ë„£ì–´ì¤€ë‹¤.

### ORM í”„ë ˆì„ì›Œí¬ Sequelize í™˜ê²½ êµ¬ì„±í•˜ê¸°

```bash
// ORM í”„ë ˆì„ì›Œí¬ì¸ sequelize íŒ¨í‚¤ì§€ì™€ MySQL ì§€ì› íŒ¨í‚¤ì§€ì¸ MySQL2ë¥¼ ë™ì‹œ ì„¤ì¹˜
npm install sequelize mysql2

// sequelize ëª…ë ¹ì–´ ì‚¬ìš©ì„ ìœ„í•œ sequelize-cli íŒ¨í‚¤ì§€ ì „ì—­ìœ¼ë¡œ ì„¤ì¹˜
npm install â€“global sequelize-cli

// í˜„ì¬ Node Express í”„ë¡œì íŠ¸ì— ORM êµ¬í˜„ì„ ìœ„í•œ ì¶”ê°€ í”„ë¡œì íŠ¸ í…œí”Œë¦¿(ì˜ˆì œì†ŒìŠ¤)ë¥¼ ì¶”ê°€
sequelize init
```

![sequelize](https://user-images.githubusercontent.com/65386533/123097140-ca43e080-d46a-11eb-9031-b6f53e277b47.PNG)

1. `sequelize init`ì„ í•˜ê³  ë‚˜ë©´ ì‚¬ì§„ê³¼ ê°™ì€ í´ë”ê°€ ì¶”ê°€ ìƒì„±ëœë‹¤.

    ğŸ“ config : DB ì—°ê²° ì •ë³´ í™˜ê²½ ì„¤ì • íŒŒì¼

    ğŸ“ models : í…Œì´ë¸”ê³¼ mappingë˜ëŠ” ëª¨ë¸ ì •ì˜ íŒŒì¼ ë³´ê´€ ë° ëª¨ë¸ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë° ì²˜ë¦¬ ëª¨ë“ˆ ì œê³µ

    ğŸ“‚ index.js

    ğŸ“ migrations

    ğŸ“ seeders

2. ğŸ“models > index.jsë¥¼ ìˆ˜ì •í•œë‹¤. (ìë™ ìƒì„± ì½”ë“œì—ëŠ” ì—ëŸ¬ê°€ ìˆìœ¼ë¯€ë¡œ)

    ```js
    // Node í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” í´ë” ê²½ë¡œ/íŒŒì¼ ê´€ë¦¬ ê°ì²´ ì°¸ì¡°
    const path = require("path");

    // Sequelize ORM í”„ë ˆì„ì›Œí¬ íŒ¨í‚¤ì§€ ì°¸ì¡°
    const Sequelize = require("sequelize");

    // DB ì—°ê²°ì •ë³´ê°€ ìˆëŠ” configíŒŒì¼ì—ì„œ developmentí•­ëª©ì˜ DBì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.
    // .env = ê°œë°œëª¨ë“œ í™˜ê²½ì„¤ì • íŒŒì¼ë¡œ, ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê³µí†µ ì •ë³´ë¥¼ ì €ì¥í•´ë†“ëŠ” íŒŒì¼ì„ ë§í•œë‹¤.
    const env = process.env.NODE_ENV || 'development';

    // ê´€ë ¨ì •ë³´ ìˆ˜ì •
    const config = require(path.join(__dirname,'..','config','config.json'))[env];

    // DBê´€ë¦¬ ê°ì²´ ìƒì„±
    const db= {};

    // DBì—°ê²°ì •ë³´ë¡œ ì‹œí€„ë¼ì´ì¦ˆ ORM ê°ì²´ ìƒì„±
    const sequelize = new Sequelize(config.database,config.username,config.password,config);

    // DB ì²˜ë¦¬ ê°ì²´ì— ì‹œí€„ë¼ì´ì¦ˆ ì •ë³´ ë§µí•‘ì²˜ë¦¬
    // ì´í›„ DBê°ì²´ë¥¼ í†µí•´ ë°ì´í„° ê´€ë¦¬ê°€ëŠ¥í•´ì§
    db.sequelize = sequelize;
    db.Sequelize = Sequelize;
    db.Config = config;

    // DBê´€ë¦¬ê°ì²´ ëª¨ë“ˆ ì¶œë ¥
    module.exports = db;
    ```

3. `npm install dotenv` env íŒ¨í‚¤ì§€ ì„¤ì¹˜ í›„ í”„ë¡œì íŠ¸ ë‚´ì— .env íŒŒì¼ì„ ë§Œë“¤ì–´ `NODE_ENV=development` ë¥¼ ì ëŠ”ë‹¤.
4. ğŸ“ config > config.jsonì— development ê°ì²´ ìˆ˜ì •

    ```json
    "development": {
    	"username": "mySQLìœ ì €ì´ë¦„",
    	"password": "ë¹„ë°€ë²ˆí˜¸",
    	"database": "DBì´ë¦„",
    	"host": "127.0.0.1",
    	"dialect": "mysql"
    }
    ```

5. `app.js` íŒŒì¼ì— ì‹œí€„ë¼ì´ì¦ˆ ëª¨ë¸ ëª¨ë“ˆì„ ì¶”ê°€í•˜ê³ , MySQLê³¼ ì—°ë™ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤.

    ```js
    // .env ì„¤ì • ê¸°ëŠ¥ ì°¸ì¡° ì ìš©
    require("dotenv").config();

    // ì‹œí€„ë¼ì´ì¦ˆ ORM ê°ì²´ ì°¸ì¡°í•˜ê¸°
    var sequelize = require("./models/index").sequelize;

    // ì‹œí€„ë¼ì´ì¦ˆ ORM ê°ì²´ë¥¼ ì´ìš©í•´ ì§€ì •í•œ MySQL ì—°ê²° ë™ê¸°í™”í•˜ê¸°
    sequelize.sync();
    ```

6. MySQL ì—°ë™ì´ ì™„ë£Œëœë‹¤.
